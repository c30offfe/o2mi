<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Step Grid</title>
  <style>
    html, body { width:100%; height:100%; margin:0; }
    body { background: rgba(0,0,0,0); font-family: system-ui, sans-serif; }
    .panel {
      position: absolute; top: 20px; left: 20px;
      background: rgba(0,0,0,0.65); color: #fff;
      padding: 12px; border-radius: 12px;
      width: 640px;
    }
    .hint { opacity: 0.85; font-size: 13px; margin-top: 4px; }
    .trackRow { display:flex; align-items:center; gap:10px; margin-top:10px; }
    .trackName { width: 70px; opacity: .9; font-size: 13px; }
    .grid { display:grid; grid-template-columns: repeat(16, 1fr); gap:6px; width: 100%; }
    .step {
      height: 22px; border-radius: 6px; cursor: pointer;
      background: rgba(255,255,255,0.12);
      border: 1px solid rgba(255,255,255,0.18);
    }
    .step.on { background: rgba(0,255,120,0.55); border-color: rgba(0,255,120,0.9); }
    .small { opacity: 0.75; font-size: 12px; margin-top: 10px; }
  </style>
</head>
<body>
<div class="panel">
  <div id="status">Overlay geladen…</div>
  <div class="hint">Klick: Step toggeln (mehrere Tracks, noch ohne Bits)</div>

  <div id="tracks"></div>

  <div class="small" id="debug"></div>
</div>

<script src="https://extension-files.twitch.tv/helper/v1/twitch-ext.min.js"></script>
<script>
  const STEPS = 16;

  // Du kannst die Track-Namen frei ändern
  const trackNames = ["Kick", "Snare", "Hat", "Bass"];

  // state[trackIndex][stepIndex] => boolean
  const state = trackNames.map(() => new Array(STEPS).fill(false));

  const tracksEl = document.getElementById("tracks");
  const statusEl = document.getElementById("status");
  const debugEl  = document.getElementById("debug");

  function patternStringForTrack(t) {
    return state[t].map(x => x ? "1" : "0").join("");
  }

  function render() {
    tracksEl.innerHTML = "";

    for (let t = 0; t < trackNames.length; t++) {
      const row = document.createElement("div");
      row.className = "trackRow";

      const name = document.createElement("div");
      name.className = "trackName";
      name.textContent = trackNames[t];

      const grid = document.createElement("div");
      grid.className = "grid";

      for (let i = 0; i < STEPS; i++) {
        const on = state[t][i];
        const b = document.createElement("div");
        b.className = "step" + (on ? " on" : "");
        b.title = `${trackNames[t]} — Step ${i + 1}`;

        b.onclick = () => {
          state[t][i] = !state[t][i];
          render();
          updateDebug();
        };

        grid.appendChild(b);
      }

      row.appendChild(name);
      row.appendChild(grid);
      tracksEl.appendChild(row);
    }
  }

  function updateDebug() {
    const lines = [];
    for (let t = 0; t < trackNames.length; t++) {
      lines.push(`${trackNames[t]}: ${patternStringForTrack(t)}`);
    }
    debugEl.textContent = lines.join("   |   ");
  }

  render();
  updateDebug();

  Twitch.ext.onAuthorized((auth) => {
    statusEl.textContent = `Overlay läuft ✅ (authorized) — channelId=${auth.channelId}`;
  });
</script>
</body>
</html>
